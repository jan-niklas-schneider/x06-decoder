<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>X06 Tonfolgen-Decoder (v4)</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<header>
  <h1>X06 Tonfolgenâ€‘Decoder</h1>
  <p class="sub">Liveâ€‘Decoder (Mikrofon) + Waterfall + Testâ€‘Signalâ€‘Generator. Mit Frequenzanzeige pro erkannter Ziffer.</p>
</header>

<main>
  <section class="card">
    <h2>Audioâ€‘Input</h2>
    <div class="row">
      <label class="small">Eingang:</label>
      <select id="selInput"></select>
      <button id="btnRefresh">â†» GerÃ¤te</button>
      <label class="toggle small">
        <input type="checkbox" id="chkFft8192" />
        <span>FFT 8192 (mehr AuflÃ¶sung, mehr CPU)</span>
      </label>
    </div>
    <p class="hint small">Tipp: Nach dem ersten â€Startâ€œ zeigt der Browser oft erst die echten GerÃ¤tenamen.</p>
  </section>

  <section class="card">
    <h2>Liveâ€‘Decoder</h2>
    <div class="row">
      <button id="btnStart">ğŸ™ï¸ Start</button>
      <button id="btnStop" disabled>â¹ï¸ Stop</button>

      <label class="toggle small">
        <input type="checkbox" id="chkAutolock" checked />
        <span>StabilitÃ¤tsâ€‘Lock</span>
      </label>

      <label class="toggle small">
        <input type="checkbox" id="chkWaterfall" checked />
        <span>Waterfall</span>
      </label>

      <label class="small">Plotâ€‘FPS</label>
      <input id="rngFps" type="range" min="5" max="60" value="20" />
      <span class="small" id="fpsVal">20</span>

      <label class="small">Gate</label>
      <input id="rngGate" type="range" min="60" max="240" value="170" />
      <span class="small" id="gateVal">170</span>
    </div>

    <div class="grid">
      <div>
        <h3>Status</h3>
        <div id="status" class="status">bereit</div>

        <h3>Erkannte Ziffer</h3>
        <div class="row">
          <div id="digit" class="digit">â€”</div>
          <div class="meta">
            <div class="small">Frequenz: <b id="freq">â€”</b></div>
            <div class="small">StÃ¤rke: <b id="strength">â€”</b></div>
          </div>
        </div>

        <h3>Sequenzâ€‘Puffer</h3>
        <div id="buffer" class="buffer">â€”</div>

        <h3>Ergebnis</h3>
        <div id="result" class="result">â€”</div>
      </div>

      <div>
        <h3>Spektrum (Band)</h3>
        <canvas id="spec" width="900" height="220"></canvas>

        <h3>Waterfall</h3>
        <canvas id="wf" width="900" height="220"></canvas>

        <div class="hint small" id="qualityHint">Start drÃ¼cken und Mikrofonzugriff erlauben.</div>
      </div>
    </div>
  </section>

  <section class="card">
    <h2>Testâ€‘Signalâ€‘Generator</h2>
    <p class="small">Erzeugt die Tonfolge lokal im Browser (kein Upload). Ideal zum Testen.</p>
    <div class="row">
      <input id="genSeq" placeholder="z.B. 124356" inputmode="numeric" />
      <label class="small">Tonâ€‘ms</label>
      <input id="genToneMs" type="number" min="60" max="2000" value="333" />
      <label class="small">Pauseâ€‘ms</label>
      <input id="genGapMs" type="number" min="0" max="2000" value="40" />
      <label class="small">LautstÃ¤rke</label>
      <input id="genVol" type="range" min="0.05" max="0.9" step="0.01" value="0.35" />
      <button id="btnGenPlay">â–¶ Play</button>
      <button id="btnGenStop" disabled>â¹ï¸ Stop</button>
      <label class="toggle small">
        <input type="checkbox" id="genLoop" />
        <span>Loop</span>
      </label>
    </div>
    <div class="hint small" id="genHint">Hinweis: FÃ¼r â€echtenâ€œ Decoderâ€‘Test kannst du den Generator auch auf einen virtuellen Eingang routen.</div>
  </section>

  <section class="card">
    <h2>Datenbank</h2>
    <div class="row">
      <input id="dbSearch" placeholder="Suche (Target / Sequenz)" />
      <button id="dbPrev">â—€</button>
      <button id="dbNext">â–¶</button>
      <span id="dbPageInfo" class="small"></span>
    </div>
    <table class="tbl" id="dbTable"></table>
    <p class="hint small">Klick auf eine Zeile Ã¼bernimmt die Sequenz in den Generator.</p>
  </section>

  <section class="card">
    <h2>Frequenzâ€‘Mapping</h2>
    <table class="tbl" id="mapTable"></table>
  </section>
</main>

<footer>
  <span class="small">Â© 2025 â€” Browserâ€‘Decoder v4</span>
</footer>

<script src="app.js"></script>
</body>
</html>
